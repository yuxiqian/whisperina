!function(){var e,t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r={},n={},a=t.parcelRequire20c8;null==a&&((a=function(e){if(e in r)return r[e].exports;if(e in n){var t=n[e];delete n[e];var a={id:e,exports:{}};return r[e]=a,t.call(a.exports,a,a.exports),a.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){n[e]=t},t.parcelRequire20c8=a);var i=a.register;function o(e,t,r,n,a,i,o){try{var s=e[i](o),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,a)}function s(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var i=e.apply(t,r);function s(e){o(i,n,a,s,c,"next",e)}function c(e){o(i,n,a,s,c,"throw",e)}s(void 0)})}}function c(e,t){var r,n,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){var f=[s,c];if(r)throw TypeError("Generator is already executing.");for(;o&&(o=0,f[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&f[0]?n.return:f[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,f[1])).done)return a;switch(n=0,a&&(f=[2&f[0],a.value]),f[0]){case 0:case 1:a=f;break;case 4:return i.label++,{value:f[1],done:!1};case 5:i.label++,n=f[1],f=[0];continue;case 7:f=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===f[0]||2===f[0])){i=0;continue}if(3===f[0]&&(!a||f[1]>a[0]&&f[1]<a[3])){i.label=f[1];break}if(6===f[0]&&i.label<a[1]){i.label=a[1],a=f;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(f);break}a[2]&&i.ops.pop(),i.trys.pop();continue}f=t.call(e,i)}catch(e){f=[6,e],n=0}finally{r=a=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}}"use strict";i("cy9PX",function(e,t){"use strict";e.exports=function(e){return e.map(function(e){return""===e?"''":e&&"object"==typeof e?e.op.replace(/(.)/g,"\\$1"):/["\s\\]/.test(e)&&!/'/.test(e)?"'"+e.replace(/(['])/g,"\\$1")+"'":/["'\s]/.test(e)?'"'+e.replace(/(["\\$`!])/g,"\\$1")+'"':String(e).replace(/([A-Za-z]:)?([#!"$&'()*,:;<=>?@[\\\]^`{|}])/g,"$1\\$2")}).join(" ")}}),i("jbaF9",function(e,t){"use strict";for(var r="(?:\\|\\||\\&\\&|;;|\\|\\&|\\<\\(|\\<\\<\\<|>>|>\\&|<\\&|[&;()|<>])",n=RegExp("^"+r+"$"),a="|&;()<> \\t",i=/^#$/,o="",s=0;s<4;s++)o+=(0x100000000*Math.random()).toString(16);var c=RegExp("^"+o);e.exports=function(e,t,s){var f=function(e,t,s){s||(s={});var c=s.escape||"\\",f=function(e,t){for(var r,n=t.lastIndex,a=[];r=t.exec(e);)a.push(r),t.lastIndex===r.index&&(t.lastIndex+=1);return t.lastIndex=n,a}(e,RegExp(["("+r+")","("+("(\\"+c+"['\""+a+"]|[^\\s'\""+a)+"])+|\"((\\\\\"|[^\"])*?)\"|'((\\\\'|[^'])*?)')+"].join("|"),"g"));if(0===f.length)return[];t||(t={});var u=!1;return f.map(function(r){var a,s=r[0];if(s&&!u){if(n.test(s))return{op:s};var f=!1,l=!1,d="",h=!1;for(a=0;a<s.length;a++){var p=s.charAt(a);if(h=h||!f&&("*"===p||"?"===p),l)d+=p,l=!1;else if(f)p===f?f=!1:"'"==f?d+=p:p===c?(a+=1,'"'===(p=s.charAt(a))||p===c||"$"===p?d+=p:d+=c+p):"$"===p?d+=g():d+=p;else if('"'===p||"'"===p)f=p;else if(n.test(p))return{op:s};else if(i.test(p)){u=!0;var b={comment:e.slice(r.index+a+1)};if(d.length)return[d,b];return[b]}else p===c?l=!0:"$"===p?d+=g():d+=p}return h?{op:"glob",pattern:d}:d}function g(){a+=1;var e,r,n,i,c,f=s.charAt(a);if("{"===f){if(a+=1,"}"===s.charAt(a))throw Error("Bad substitution: "+s.slice(a-2,a+1));if((i=s.indexOf("}",a))<0)throw Error("Bad substitution: "+s.slice(a));c=s.slice(a,i),a=i}else if(/[*@#?$!_-]/.test(f))c=f,a+=1;else{var u=s.slice(a);(i=u.match(/[^\w\d_]/))?(c=u.slice(0,i.index),a+=i.index-1):(c=u,a=s.length)}return e=t,r=c,(void 0===(n="function"==typeof e?e(r):e[r])&&""!=r?n="":void 0===n&&(n="$"),"object"==typeof n)?""+o+JSON.stringify(n)+o:""+n}}).reduce(function(e,t){return void 0===t?e:e.concat(t)},[])}(e,t,s);return"function"!=typeof t?f:f.reduce(function(e,t){if("object"==typeof t)return e.concat(t);var r=t.split(RegExp("("+o+".*?"+o+")","g"));return 1===r.length?e.concat(r[0]):e.concat(r.filter(Boolean).map(function(e){return c.test(e)?JSON.parse(e.split(o)[1]):e}))},[])}}),"function"==typeof SuppressedError&&SuppressedError;var f=iina.preferences,u=[{name:"tiny",size:"75 MiB",sha:"bd577a113a864445d4c299885e0cb97d4ba92b5f"},{name:"tiny.en",size:"75 MiB",sha:"c78c86eb1a8faa21b369bcd33207cc90d64ae9df"},{name:"base",size:"142 MiB",sha:"465707469ff3a37a2b9b8d8f89f2f99de7299dac"},{name:"base.en",size:"142 MiB",sha:"137c40403d78fd54d454da0f9bd998f78703390c"},{name:"small",size:"466 MiB",sha:"55356645c2b361a969dfd0ef2c5a50d530afd8d5"},{name:"small.en",size:"466 MiB",sha:"db8a495a91d927739e50b3fc1cc4c6b8f6c2d022"},{name:"small.en-tdrz",size:"465 MiB",sha:"b6c6e7e89af1a35c08e6de56b66ca6a02a2fdfa1"},{name:"medium",size:"1.5 GiB",sha:"fd9727b6e1217c2f614f9b698455c4ffd82463b4"},{name:"medium.en",size:"1.5 GiB",sha:"8c30f0e44ce9560643ebd10bbe50cd20eafd3723"},{name:"large-v1",size:"2.9 GiB",sha:"b1caaf735c4cc1429223d5a74f0f4d0b9b59a299"},{name:"large-v2",size:"2.9 GiB",sha:"0f4c8e34f21cf1a914c59d8b3ce882345ad349d6"},{name:"large-v2-q5_0",size:"1.1 GiB",sha:"00e39f2196344e901b3a2bd5814807a769bd1630"},{name:"large-v3",size:"2.9 GiB",sha:"ad82bf6a9043ceed055076d0fd39f5f186ff8062"},{name:"large-v3-q5_0",size:"1.1 GiB",sha:"e6e2ed78495d403bef4b7cff42ef4aaadcfea8de"},{name:"large-v3-turbo",size:"1.5 GiB",sha:"4af2b29d7ec73d781377bfd1758ca957a807e941"},{name:"large-v3-turbo-q5_0",size:"547 MiB",sha:"e050f7970618a659205450ad97eb95a18d69c9ee"}];a("cy9PX"),e=a("jbaF9");var l=iina.console,d=iina.core,h=iina.preferences,p=iina.utils,b="~/Library/Application Support/com.colliderli.iina/plugins/";function g(e,t,r){return s(function(){var n,a,i,o;return c(this,function(s){switch(s.label){case 0:return[4,p.exec(e,t,r)];case 1:if(a=(n=s.sent()).status,i=n.stdout,o=n.stderr,l.log(a),l.log(i),l.log(o),0!==a)throw Error(`Bad return status code: ${a}`);return[2]}})})()}var v=function(){var e="io.github.yuxiqian.whisperina.iinaplugin",t="whisperina.iinaplugin-dev";if(p.fileInPath(b+e))return p.resolvePath(b+e);if(p.fileInPath(b+t))return p.resolvePath(b+t);throw Error("Unable to locate plugin folder.")}(),m=p.resolvePath("@data/"),w=iina.subtitle;w.registerProvider("whisper",{search:function(){return s(function(){return c(this,function(e){return[2,u.filter(function(e){return f.get("show_"+e.name.replaceAll(/[-.]/g,"_"))}).map(function(e){return w.item({id:e.name,name:e.name,size:e.size,sha:e.sha,format:"srt"})})]})})()},description:function(e){return{name:e.data.id,left:e.data.size,right:e.data.sha}},download:function(t){return s(function(){return c(this,function(r){var n;return[2,Promise.resolve((n=t.data.id,s(function(){var t,r,a;return c(this,function(i){var o,f,u,l;switch(i.label){case 0:return[4,(o=n,s(function(){return c(this,function(e){switch(e.label){case 0:if(!p.fileInPath(`@data/ggml-${o}.bin`))return[3,1];return d.osd(`Model ${o} already exists.`),[3,4];case 1:if(!p.ask(`Model ${o} does not exist. Would you like to download it now?`))return[3,3];return[4,g(`${v}/bin/download-ggml-model.sh`,[o],m)];case 2:return e.sent(),d.osd(`Model ${o} has been successfully downloaded.`),[3,4];case 3:throw Error(`No such model ${o}.`);case 4:return[2]}})})())];case 1:if(i.sent(),!(t=d.status.url).startsWith("file://"))throw Error(`Subtitle generation doesn't work with non-local file ${t}.`);return r=t.substring(7),d.osd("Generating temporary wave file..."),[4,(f=r,s(function(){var e;return c(this,function(t){switch(t.label){case 0:return e=p.resolvePath("@tmp/whisper_tmp.wav"),[4,g(function(){var e=h.get("ffmpeg_path");if(!p.fileInPath(e))throw Error(`Unable to locate ffmpeg executable at: ${e}. Check the preference page for more details.`);return e}(),["-y","-i",f,"-ar","16000","-ac","1","-c:a","pcm_s16le",e])];case 1:return t.sent(),[2,e]}})})())];case 2:return a=i.sent(),d.osd("Transcribing..."),[4,(u=a,l=n,s(function(){return c(this,function(t){switch(t.label){case 0:return[4,g(function(){var e=h.get("wcli_path");if(!p.fileInPath(e))throw Error(`Unable to locate Whisper CLI executable at: ${e}. Check the preference page for more details.`);return e}(),function(t){try{var r=e(h.get("wcli_options"));if(r&&r.length>0)return t.concat(r)}catch(e){}return t}(["-f",u,"-m",`${m}/ggml-${l}.bin`,"-osrt"]))];case 1:return t.sent(),[2]}})})())];case 3:return i.sent(),d.osd("Transcription succeeded."),[2,[p.resolvePath("@tmp/whisper_tmp.wav.srt")]]}})})()))]})})()}})}();
//# sourceMappingURL=index.js.map
