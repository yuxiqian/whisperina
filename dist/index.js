!function(){function e(e,r,a,t,n,i,o){try{var s=e[i](o),c=s.value}catch(e){a(e);return}s.done?r(c):Promise.resolve(c).then(t,n)}function r(r){return function(){var a=this,t=arguments;return new Promise(function(n,i){var o=r.apply(a,t);function s(r){e(o,n,i,s,c,"next",r)}function c(r){e(o,n,i,s,c,"throw",r)}s(void 0)})}}function a(e,r){var a,t,n,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){var u=[s,c];if(a)throw TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(i=0)),i;)try{if(a=1,t&&(n=2&u[0]?t.return:u[0]?t.throw||((n=t.return)&&n.call(t),0):t.next)&&!(n=n.call(t,u[1])).done)return n;switch(t=0,n&&(u=[2&u[0],n.value]),u[0]){case 0:case 1:n=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,t=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(n=(n=i.trys).length>0&&n[n.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!n||u[1]>n[0]&&u[1]<n[3])){i.label=u[1];break}if(6===u[0]&&i.label<n[1]){i.label=n[1],n=u;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(u);break}n[2]&&i.ops.pop(),i.trys.pop();continue}u=r.call(e,i)}catch(e){u=[6,e],t=0}finally{a=n=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}}"function"==typeof SuppressedError&&SuppressedError;var t=iina.preferences,n=[{name:"tiny",size:"75 MiB",sha:"bd577a113a864445d4c299885e0cb97d4ba92b5f"},{name:"tiny.en",size:"75 MiB",sha:"c78c86eb1a8faa21b369bcd33207cc90d64ae9df"},{name:"base",size:"142 MiB",sha:"465707469ff3a37a2b9b8d8f89f2f99de7299dac"},{name:"base.en",size:"142 MiB",sha:"137c40403d78fd54d454da0f9bd998f78703390c"},{name:"small",size:"466 MiB",sha:"55356645c2b361a969dfd0ef2c5a50d530afd8d5"},{name:"small.en",size:"466 MiB",sha:"db8a495a91d927739e50b3fc1cc4c6b8f6c2d022"},{name:"small.en-tdrz",size:"465 MiB",sha:"b6c6e7e89af1a35c08e6de56b66ca6a02a2fdfa1"},{name:"medium",size:"1.5 GiB",sha:"fd9727b6e1217c2f614f9b698455c4ffd82463b4"},{name:"medium.en",size:"1.5 GiB",sha:"8c30f0e44ce9560643ebd10bbe50cd20eafd3723"},{name:"large-v1",size:"2.9 GiB",sha:"b1caaf735c4cc1429223d5a74f0f4d0b9b59a299"},{name:"large-v2",size:"2.9 GiB",sha:"0f4c8e34f21cf1a914c59d8b3ce882345ad349d6"},{name:"large-v2-q5_0",size:"1.1 GiB",sha:"00e39f2196344e901b3a2bd5814807a769bd1630"},{name:"large-v3",size:"2.9 GiB",sha:"ad82bf6a9043ceed055076d0fd39f5f186ff8062"},{name:"large-v3-q5_0",size:"1.1 GiB",sha:"e6e2ed78495d403bef4b7cff42ef4aaadcfea8de"},{name:"large-v3-turbo",size:"1.5 GiB",sha:"4af2b29d7ec73d781377bfd1758ca957a807e941"},{name:"large-v3-turbo-q5_0",size:"547 MiB",sha:"e050f7970618a659205450ad97eb95a18d69c9ee"}],i=iina.console,o=iina.core,s=iina.utils,c="~/Library/Application Support/com.colliderli.iina/plugins/";function u(e,t,n){return r(function(){var r,o,c,u;return a(this,function(a){switch(a.label){case 0:return[4,s.exec(e,t,n)];case 1:if(o=(r=a.sent()).status,c=r.stdout,u=r.stderr,i.log(o),i.log(c),i.log(u),0!==o)throw Error(`Bad return status code: ${o}`);return[2]}})})()}var f=function(){var e="io.github.yuxiqian.whisperina.iinaplugin",r="whisperina.iinaplugin-dev";if(s.fileInPath(c+e))return s.resolvePath(c+e);if(s.fileInPath(c+r))return s.resolvePath(c+r);throw Error("Unable to allocate plugin folder.")}(),l=s.resolvePath("@data/"),d=iina.subtitle;d.registerProvider("whisper",{search:function(){return r(function(){return a(this,function(e){return[2,n.filter(function(e){return t.get("show_"+e.name.replaceAll(/[-.]/g,"_"))}).map(function(e){return d.item({id:e.name,name:e.name,size:e.size,sha:e.sha,format:"srt"})})]})})()},description:function(e){return{name:e.data.id,left:e.data.size,right:e.data.sha}},download:function(e){return r(function(){return a(this,function(t){var n;return[2,Promise.resolve((n=e.data.id,r(function(){var e,t,c;return a(this,function(d){var h,b,p,m;switch(d.label){case 0:return[4,(h=n,r(function(){return a(this,function(e){switch(e.label){case 0:if(!s.fileInPath(`@data/ggml-${h}.bin`))return[3,1];return o.osd(`Model ${h} already exists.`),[3,4];case 1:if(!s.ask(`Model ${h} does not exist. Would you like to download it now?`))return[3,3];return[4,s.exec(`${f}/bin/download-ggml-model.sh`,[h],l).catch(function(e){return i.error(e)})];case 2:return e.sent(),o.osd(`Model ${h} has been successfully downloaded.`),[3,4];case 3:throw Error(`No such model ${h}.`);case 4:return[2]}})})())];case 1:if(d.sent(),!(e=o.status.url).startsWith("file://"))throw Error(`Subtitle generation doesn't work with non-local file ${e}.`);return t=e.substring(7),o.osd("Generating temporary wave file..."),[4,(b=t,r(function(){var e;return a(this,function(r){switch(r.label){case 0:return e=s.resolvePath("@tmp/whisper_tmp.wav"),[4,u(function(){var e="/opt/homebrew/bin/ffmpeg";if(!s.fileInPath(e))throw Error(`Unable to locate ffmpeg executable at: ${e}`);return e}(),["-y","-i",b,"-ar","16000","-ac","1","-c:a","pcm_s16le",e])];case 1:return r.sent(),[2,e]}})})())];case 2:return c=d.sent(),o.osd("Transcribing..."),[4,(p=c,m=n,r(function(){return a(this,function(e){switch(e.label){case 0:return[4,u(function(){var e="/opt/homebrew/bin/whisper-cli";if(!s.fileInPath(e))throw Error(`Unable to locate Whisper CLI executable at: ${e}`);return e}(),["-f",p,"-m",`${l}/ggml-${m}.bin`,"-osrt"])];case 1:return e.sent(),[2]}})})())];case 3:return d.sent(),o.osd("Transcription succeeded."),[2,[s.resolvePath("@tmp/whisper_tmp.wav.srt")]]}})})()))]})})()}})}();
//# sourceMappingURL=index.js.map
