!function(){function e(e,r,t,a,n,i,o){try{var s=e[i](o),c=s.value}catch(e){t(e);return}s.done?r(c):Promise.resolve(c).then(a,n)}function r(r){return function(){var t=this,a=arguments;return new Promise(function(n,i){var o=r.apply(t,a);function s(r){e(o,n,i,s,c,"next",r)}function c(r){e(o,n,i,s,c,"throw",r)}s(void 0)})}}function t(e,r){var t,a,n,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){var f=[s,c];if(t)throw TypeError("Generator is already executing.");for(;o&&(o=0,f[0]&&(i=0)),i;)try{if(t=1,a&&(n=2&f[0]?a.return:f[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,f[1])).done)return n;switch(a=0,n&&(f=[2&f[0],n.value]),f[0]){case 0:case 1:n=f;break;case 4:return i.label++,{value:f[1],done:!1};case 5:i.label++,a=f[1],f=[0];continue;case 7:f=i.ops.pop(),i.trys.pop();continue;default:if(!(n=(n=i.trys).length>0&&n[n.length-1])&&(6===f[0]||2===f[0])){i=0;continue}if(3===f[0]&&(!n||f[1]>n[0]&&f[1]<n[3])){i.label=f[1];break}if(6===f[0]&&i.label<n[1]){i.label=n[1],n=f;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(f);break}n[2]&&i.ops.pop(),i.trys.pop();continue}f=r.call(e,i)}catch(e){f=[6,e],a=0}finally{t=n=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}}"function"==typeof SuppressedError&&SuppressedError;var a=iina.preferences,n=[{name:"tiny",size:"75 MiB",sha:"bd577a113a864445d4c299885e0cb97d4ba92b5f"},{name:"tiny.en",size:"75 MiB",sha:"c78c86eb1a8faa21b369bcd33207cc90d64ae9df"},{name:"base",size:"142 MiB",sha:"465707469ff3a37a2b9b8d8f89f2f99de7299dac"},{name:"base.en",size:"142 MiB",sha:"137c40403d78fd54d454da0f9bd998f78703390c"},{name:"small",size:"466 MiB",sha:"55356645c2b361a969dfd0ef2c5a50d530afd8d5"},{name:"small.en",size:"466 MiB",sha:"db8a495a91d927739e50b3fc1cc4c6b8f6c2d022"},{name:"small.en-tdrz",size:"465 MiB",sha:"b6c6e7e89af1a35c08e6de56b66ca6a02a2fdfa1"},{name:"medium",size:"1.5 GiB",sha:"fd9727b6e1217c2f614f9b698455c4ffd82463b4"},{name:"medium.en",size:"1.5 GiB",sha:"8c30f0e44ce9560643ebd10bbe50cd20eafd3723"},{name:"large-v1",size:"2.9 GiB",sha:"b1caaf735c4cc1429223d5a74f0f4d0b9b59a299"},{name:"large-v2",size:"2.9 GiB",sha:"0f4c8e34f21cf1a914c59d8b3ce882345ad349d6"},{name:"large-v2-q5_0",size:"1.1 GiB",sha:"00e39f2196344e901b3a2bd5814807a769bd1630"},{name:"large-v3",size:"2.9 GiB",sha:"ad82bf6a9043ceed055076d0fd39f5f186ff8062"},{name:"large-v3-q5_0",size:"1.1 GiB",sha:"e6e2ed78495d403bef4b7cff42ef4aaadcfea8de"},{name:"large-v3-turbo",size:"1.5 GiB",sha:"4af2b29d7ec73d781377bfd1758ca957a807e941"},{name:"large-v3-turbo-q5_0",size:"547 MiB",sha:"e050f7970618a659205450ad97eb95a18d69c9ee"}],i=iina.console,o=iina.core,s=iina.preferences,c=iina.utils,f="~/Library/Application Support/com.colliderli.iina/plugins/";function u(e,a,n){return r(function(){var r,o,s,f;return t(this,function(t){switch(t.label){case 0:return[4,c.exec(e,a,n)];case 1:if(o=(r=t.sent()).status,s=r.stdout,f=r.stderr,i.log(o),i.log(s),i.log(f),0!==o)throw Error(`Bad return status code: ${o}`);return[2]}})})()}var l=function(){var e="io.github.yuxiqian.whisperina.iinaplugin",r="whisperina.iinaplugin-dev";if(c.fileInPath(f+e))return c.resolvePath(f+e);if(c.fileInPath(f+r))return c.resolvePath(f+r);throw Error("Unable to locate plugin folder.")}(),d=c.resolvePath("@data/"),h=iina.subtitle;h.registerProvider("whisper",{search:function(){return r(function(){return t(this,function(e){return[2,n.filter(function(e){return a.get("show_"+e.name.replaceAll(/[-.]/g,"_"))}).map(function(e){return h.item({id:e.name,name:e.name,size:e.size,sha:e.sha,format:"srt"})})]})})()},description:function(e){return{name:e.data.id,left:e.data.size,right:e.data.sha}},download:function(e){return r(function(){return t(this,function(a){var n;return[2,Promise.resolve((n=e.data.id,r(function(){var e,a,i;return t(this,function(f){var h,b,p,m;switch(f.label){case 0:return[4,(h=n,r(function(){return t(this,function(e){switch(e.label){case 0:if(!c.fileInPath(`@data/ggml-${h}.bin`))return[3,1];return o.osd(`Model ${h} already exists.`),[3,4];case 1:if(!c.ask(`Model ${h} does not exist. Would you like to download it now?`))return[3,3];return[4,u(`${l}/bin/download-ggml-model.sh`,[h],d)];case 2:return e.sent(),o.osd(`Model ${h} has been successfully downloaded.`),[3,4];case 3:throw Error(`No such model ${h}.`);case 4:return[2]}})})())];case 1:if(f.sent(),!(e=o.status.url).startsWith("file://"))throw Error(`Subtitle generation doesn't work with non-local file ${e}.`);return a=e.substring(7),o.osd("Generating temporary wave file..."),[4,(b=a,r(function(){var e;return t(this,function(r){switch(r.label){case 0:return e=c.resolvePath("@tmp/whisper_tmp.wav"),[4,u(function(){var e=s.get("ffmpeg_path");if(!c.fileInPath(e))throw Error(`Unable to locate ffmpeg executable at: ${e}. Check the preference page for more details.`);return e}(),["-y","-i",b,"-ar","16000","-ac","1","-c:a","pcm_s16le",e])];case 1:return r.sent(),[2,e]}})})())];case 2:return i=f.sent(),o.osd("Transcribing..."),[4,(p=i,m=n,r(function(){return t(this,function(e){switch(e.label){case 0:return[4,u(function(){var e=s.get("wcli_path");if(!c.fileInPath(e))throw Error(`Unable to locate Whisper CLI executable at: ${e}. Check the preference page for more details.`);return e}(),function(e){try{var r=s.get("wcli_options");if(r&&r.length>0)return e.concat(r)}catch(e){}return e}(["-f",p,"-m",`${d}/ggml-${m}.bin`,"-osrt"]))];case 1:return e.sent(),[2]}})})())];case 3:return f.sent(),o.osd("Transcription succeeded."),[2,[c.resolvePath("@tmp/whisper_tmp.wav.srt")]]}})})()))]})})()}})}();
//# sourceMappingURL=index.js.map
